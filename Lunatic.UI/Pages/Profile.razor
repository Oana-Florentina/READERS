@page "/profile"
@using Lunatic.UI.Contracts
@using Lunatic.UI.ViewModels
@using Blazored.LocalStorage;

@inject IUserDataService UserDataService
@inject NavigationManager NavigationManager
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css\profile.css">
    <title>Book details</title>
</head>
<h3>User Profile</h3>

@if (User == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="profile-details">
        <h4>@User.Username's Profile</h4>
        <p><strong>First Name:</strong> @User.FirstName</p>
        <p><strong>Last Name:</strong> @User.LastName</p>
        <p><strong>Email:</strong> @User.Email</p>
        <p><strong>Username:</strong> @User.Username</p>
       
        
       

        <!-- Action Buttons -->
        <button class="btn btn-primary" @onclick="EditProfile">Edit Profile</button>
    </div>
}

@code {
    [Parameter]
    public Guid userId { get; set; }
    [Inject]
    public ITokenService tokenService { get; set; }
    [Inject]
    public IDataService dataService { get; set; }

    public ProfileViewModel? User { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var userId = await dataService.GetItemAsync<Guid>("UserId");

            User = await UserDataService.GetUserByIdAsync(userId);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading profile: {ex.Message}");
            // Handle the error (e.g., redirect to login or show a message)
           
        }
        
    }

    private void EditProfile()
    {
        NavigationManager.NavigateTo($"/editProfile");
    }
}
